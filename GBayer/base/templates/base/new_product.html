{% extends 'base/base.html' %}
{% block content %}

<div class="conteiner" xmlns="http://www.w3.org/1999/html">
    <div class="row">
        <div class="col-2 mt-5">
            <button type="button" class="shadow btn btn-outline-dark btn-lg mt-2" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">
                Добавить<hr>нового клиента<br>или<br> новый магазин
            </button></a>
            <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
              <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="offcanvasExampleLabel"></h5>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Закрыть"></button>
              </div>
              <div class="offcanvas-body">
                  <div class="conteiner">
                    <div class="row">
                        <div class="col-12">
                            <form action="{% url 'new_product' %}" method="post" enctype="multipart/form-data">
                                <span class=""><h5>Добавить нового клиента</h5></span><br>
                                {% csrf_token %}
                                {{form_client.as_p}}
                                <button type="submit" class="offset-8 btn btn-dark shadow-sm">Добавить</button>
                                <hr>
                            </form>
                            <form action="{% url 'new_product' %}" method="post" enctype="multipart/form-data">
                                <span class=""><h5>Добавить новый магазин</h5></span><br>
                                {% csrf_token %}
                                {{form_shop.as_p}}
                                <button type="submit" class="offset-8 btn btn-dark shadow-sm">Добавить</button>
                            </form>
                        </div>
                    </div>
                </div>
              </div>
            </div>
        </div>
        <div class="col-8">
            <h4 class="md-3">Добавление нового заказа</h4><hr>
            <div class="border border-dark rounded-2 p-3 shadow">
                <form class="row g-2 ustify-content-center" action="{% url 'new_product' %}" id="form_new_prod"
                      method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="col-md-12">
                        <label class="form-label">Описание</label>
                        {{form.description}}
                    </div>
                    <div class="col-md-5">
                        <label class="form-label">Фото</label>
                        {{form.image}}
                    </div>
                    <div class="col-md-3 offset-1">
                        <label class="form-label">Категория</label>
                        {{form.category}}
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Статус</label>
                        {{form.status}}
                    </div>
                    <div class="col-md-5">
                        <label class="form-label">Клиент</label>
                        {{form.client}}
                        <datalist id="listClient">
                            {% for c in client %}
                            <option label="{{c.telephone}}" value={{c.pk}}></option>
                            {% endfor %}
                        </datalist>
                    </div>
                    <div class="col-md-6 offset-1">
                        <label class="form-label">Магазин</label>
                        {{form.shop}}
                    </div>
                    <div class="col-md-3">
                        <div class="row">
                        <label class="form-label">Цена покупки в валюте</label>
                            <div class="input-group">
                                <input class="form-control" id="price_currency" placeholder="Цена в валюте">
                                <div class="col-4 btn-group btn-outline-secondary border" role="group" aria-label="Валюта">
                                    <input type="radio" class="btn-check" name="currency" onclick="func(1)" id="eur" value={{rate.eur|floatformat:2}} autocomplete="off">
                                        <label class="btn" for="eur">€</label>
                                    <input type="radio" class="btn-check" name="currency" onclick="func(3)" id="usd" value={{rate.usd|floatformat:2}} autocomplete="off">
                                        <label class="btn border-start" for="usd">$</label>
                                </div>
                                <script>
                            function func(op) {
                                var purchase_price;
                                var eur = parseFloat(document.getElementById("eur").value.replace(',', '.'));
                                var usd = parseFloat(document.getElementById("usd").value.replace(',', '.'));
                                var price_currency = Number(document.getElementById("price_currency").value);
                                if (op < 2){
                                    purchase_price = price_currency * eur;
                                } else {
                                    purchase_price = price_currency * usd;
                                }
                                document.getElementById("purchase_price").value = purchase_price.toFixed(0);
                                }
                        </script>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Цена покупки в рублях</label>
                        <input class="form-control" name="purchase_price"
                               placeholder="Цена в рублях" id="purchase_price">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Цена продажи</label>
                        {{form.selling_price}}
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Сумма предоплаты</label>
                        {{form.prepayment}}
                    </div>
                    <p></p>
                </form>
            </div>
            <hr>
        </div>
    </div>
    <div class="row my-2 justify-content-center">
        <div class="col-2 offset-5 text-end">
            <a href = "{% url 'general' %}">
                <button type="button" class="btn btn-outline-secondary btn-lg shadow">Отмена</button>
            </a>
        </div>
        <div class="col-2">
            <button type="submit" form="form_new_prod" class="btn btn-dark btn-lg shadow">Добавить</button>
        </div>
    </div>
</div>
{% endblock %}